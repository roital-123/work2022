### 孤儿进程

- 父进程结束时，子进程尚未结束，此时子进程就会成为孤儿进程，孤儿进程会被init进程领养



### 僵尸进程

- 子进程结束时，父进程不回收子进程使用的资源（如一直占用进程id），长时间堆积大量的僵尸进程会使得创建新的子进程时无可用的进程id而无法创建成功
- 因此，父进程需要通过wait和waitpid在子进程结束时回收子进程资源



### 守护进程

- 守护进程相关概念

  ​	守护进程也称为精灵进程（daemon），是运行在后台的一种特殊进程。它独立于控制终端并且周期性的执行某种任务或等待某些发生的事件。守护进程是一种很有用的进程。Linux的大多数服务器就是用守护进程实现的。比如：ftp服务器，ssh服务器，web服务器http服务器等。

  ​	Linux系统启动时会启动很多系统服务进程（守护进程），他们没有控制终端，不能直接和用户交互。其他进程都是在用户登录或运行程序时创建，在运行结束或用户注销时终止，但是守护进程不受用户登录和注销的影响，它们一直运行着。

  ​	ps -axj命令查看系统中的进程。参数a表示不仅列当前用户的进程，也列出所有其他用户的进程；参数x表示不仅列出有控制终端的进程，也列出所有无控制终端的进程；参数j表示列出与作业控制相关的进程。

  ​	对比ps-aux

- 创建守护教程的步骤

  1、创建子进程，父进程退出。

  经过这步以后，子进程就会成为孤儿进程(父进程先于子进程退出， 此时的子进程，成为孤儿进程，会被init进程收养)。使用fork()函数，如果返回值大于0，表示为父进程，exit(0)，父进程退出，子进程继续。

  2、在子进程中创建新会话，使当前进程成为新会话组的组长。

  使用setsid()函数，如果当前进程不是进程组的组长，则为当前进程创建一个新的会话期，使当前进程成为这个会话组的首进程，成为这个进程组的组长。

  3、改变当前目录为根目录。

  由于守护进程在后台运行，开始于系统开启，终止于系统关闭，所以要将其目录改为系统的根目录下。进程在执行时，其文件系统不能被卸下。

  4、重新设置文件权限掩码。

  进程从父进程那里继承了文件创建掩码，所以可能会修改守护进程存取权限位，所以要将文件创建掩码清除，umask(0)；

  5、关闭文件描述符。

  子进程从父进程那里继承了打开文件描述符。所以使用close即可关闭。